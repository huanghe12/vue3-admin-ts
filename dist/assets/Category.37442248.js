import{h as U,r as j,t as T,_ as M,b as K,v as W}from"./index.2323aac0.js";import{d as I,K as V,N as $,r as q,R as S,e as p,f as w,j as X,w as o,h as Y,k as a,i as r,T as G,X as R,m,E as C,u as H,o as J,V as O,g as P,Y as Q,W as Z}from"./vendor.9dd18d83.js";const ee={class:"dialog-footer"},te=m("\u53D6 \u6D88"),ae=m("\u786E \u5B9A"),oe=I({props:{queryCategories:Function},setup(h,{expose:v}){const B=h,F=V(),l=$(),u=q({visible:!1,title:"\u6DFB\u52A0\u5206\u7C7B",formData:{categoryId:"",categoryLevel:"",categoryName:"",categoryRank:"",parentId:""},rules:{categoryName:[{required:!0,message:"\u5206\u7C7B\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],categoryRank:[{required:!0,message:"\u6392\u5E8F\u503C\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),k=async n=>{const{data:e}=await T(n);u.formData={categoryId:e.categoryId,categoryLevel:e.categoryLevel,categoryName:e.categoryName,categoryRank:e.categoryRank,parentId:e.parentId}},b=n=>{if(u.visible=!0,u.title=n?"\u4FEE\u6539\u5206\u7C7B":"\u6DFB\u52A0\u5206\u7C7B",n)return k(n);const{level:e=1,parent_id:t=0}=F.query;u.formData={categoryId:"",categoryLevel:e,categoryName:"",categoryRank:"",parentId:t}},N=()=>{var n;(n=l.value)==null||n.resetFields()},D=()=>{var n;(n=l.value)==null||n.validate(async e=>{if(e){if(U(u.formData.categoryName))return C.error("\u4E0D\u8981\u8F93\u5165\u8868\u60C5\u5305\uFF0C\u518D\u8F93\u5165\u5C31\u6253\u6B7B\u4F60\u4E2A\u9F9F\u5B59\u513F~");await j(u.formData,u.formData.categoryId?"put":"post"),C.success(u.formData.categoryId?"\u4FEE\u6539\u6210\u529F":"\u6DFB\u52A0\u6210\u529F"),u.visible=!1,B.queryCategories()}})},{visible:_,title:x,rules:y,formData:d}=S(u);return v({open:b}),(n,e)=>{const t=p("el-input"),c=p("el-form-item"),f=p("el-button"),g=p("el-dialog");return w(),X(g,{modelValue:r(_),"onUpdate:modelValue":e[3]||(e[3]=i=>R(_)?_.value=i:null),title:r(x),width:"400px",onClose:N},{footer:o(()=>[Y("span",ee,[a(f,{onClick:e[2]||(e[2]=i=>_.value=!1)},{default:o(()=>[te]),_:1}),a(f,{type:"primary",onClick:D},{default:o(()=>[ae]),_:1})])]),default:o(()=>[a(r(G),{ref:(i,A)=>{A.formRef=i,l.value=i},model:r(d),rules:r(y),"label-position":"right","label-width":"100px"},{default:o(()=>[a(c,{label:"\u5206\u7C7B\u540D\u79F0:",prop:"categoryName"},{default:o(()=>[a(t,{modelValue:r(d).categoryName,"onUpdate:modelValue":e[0]||(e[0]=i=>r(d).categoryName=i),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),a(c,{label:"\u6392\u5E8F\u503C:",prop:"categoryRank"},{default:o(()=>[a(t,{modelValue:r(d).categoryRank,"onUpdate:modelValue":e[1]||(e[1]=i=>r(d).categoryRank=i),type:"number",max:200,style:{width:"200px"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const ue=m("\u589E\u52A0"),le=m("\u6279\u91CF\u5220\u9664"),ne=m("\u4FEE\u6539"),re=m("\u4E0B\u7EA7\u5206\u7C7B"),se=m("\u5220\u9664"),ce=I({setup(h){const v=H(),B=V(),F=$(),l=q({loading:!1,pageNumber:1,pageSize:10,total:0,tableData:[],multipleSelection:[]}),u=async()=>{l.loading=!0;const{level:e=1,parent_id:t=0}=B.query,{data:c}=await K({params:{pageNumber:l.pageNumber,pageSize:l.pageSize,categoryLevel:e,parentId:t}});l.tableData=c.list,l.total=c.totalCount,l.loading=!1},k=e=>{l.multipleSelection=e.map(t=>t.categoryId)},b=async e=>{if(!e&&!l.multipleSelection.length)return C.error("\u8BF7\u9009\u62E9\u9879");const t={ids:e?[e]:l.multipleSelection};await W(t),C.success("\u5220\u9664\u6210\u529F"),u()},N=e=>{const t=e.categoryLevel+1;if(t===4)return C.error("\u6CA1\u6709\u4E0B\u4E00\u7EA7");v.push({path:`/category/level${t}`,query:{level:t,parent_id:e.categoryId}})};v.afterEach(e=>{["category","level2","level3"].includes(e.name)&&u()});const D=e=>{F.value.open(e)};J(()=>{u()});const{loading:_,tableData:x,pageNumber:y,pageSize:d,total:n}=S(l);return(e,t)=>{const c=p("el-button"),f=p("el-popconfirm"),g=p("el-table-column"),i=p("el-table"),A=p("el-pagination"),z=p("el-card"),L=O("loading");return w(),P(Q,null,[a(z,null,{header:o(()=>[a(c,{icon:"el-icon-plus",type:"primary",size:"small",onClick:t[0]||(t[0]=s=>D())},{default:o(()=>[ue]),_:1}),a(f,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:t[1]||(t[1]=s=>b())},{reference:o(()=>[a(c,{icon:"el-icon-delete",type:"danger",size:"small"},{default:o(()=>[le]),_:1})]),_:1})]),default:o(()=>[Z(a(i,{data:r(x),onSelectionChange:k},{default:o(()=>[a(g,{type:"selection"}),a(g,{label:"\u5206\u7C7B\u540D\u79F0",align:"center",prop:"categoryName"}),a(g,{label:"\u6392\u5E8F\u503C",align:"center",prop:"categoryRank"}),a(g,{label:"\u6DFB\u52A0\u65F6\u95F4",align:"center",prop:"createTime"}),a(g,{label:"\u64CD\u4F5C",align:"center"},{default:o(({row:s})=>[a(c,{type:"text",onClick:E=>D(s.categoryId)},{default:o(()=>[ne]),_:2},1032,["onClick"]),a(c,{type:"text",onClick:E=>N(s)},{default:o(()=>[re]),_:2},1032,["onClick"]),a(f,{title:"\u786E\u5B9A\u5220\u9664\u5417\uFF1F",onConfirm:E=>b(s.categoryId)},{reference:o(()=>[a(c,{type:"text"},{default:o(()=>[se]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),[[L,r(_)]]),a(A,{"current-page":r(y),"onUpdate:current-page":t[2]||(t[2]=s=>R(y)?y.value=s:null),"page-size":r(d),"onUpdate:page-size":t[3]||(t[3]=s=>R(d)?d.value=s:null),background:"",layout:"prev, pager, next",total:r(n),onCurrentChange:u},null,8,["current-page","page-size","total"])]),_:1}),a(oe,{ref:(s,E)=>{E.categoryRef=s,F.value=s},"query-categories":u},null,512)],64)}}});var de=M(ce,[["__scopeId","data-v-906b4a56"]]);export{de as default};
